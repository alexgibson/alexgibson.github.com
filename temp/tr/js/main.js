var TRMixer=function(){"use strict";var e,t,n,r,i,s,o,u,a,f,l={},c,h,p,d,v="ontouchstart"in window||"createTouch"in document,m=v?"touchstart":"mousedown",g=v?"touchmove":"mousemove",y=v?"touchend":"mouseup",b=!1,w=!1;return{init:function(){var e=document;if("webkitAudioContext"in window)c=new webkitAudioContext;else{if(!("AudioContext"in window)){console.error("Your device does not yet support the Web Audio API");return}c=new AudioContext}e.getElementById("play").addEventListener("click",TRMixer.playSounds,!1);e.getElementById("stop").addEventListener("click",TRMixer.stopSounds,!1);TRMixer.loadSoundFile("sound1.mp3",1);TRMixer.loadSoundFile("sound2.mp3",2);TRMixer.loadSoundFile("sound3.mp3",3);TRMixer.loadSoundFile("sound4.mp3",4);l.volume1=c.createGainNode();l.volume2=c.createGainNode();l.volume3=c.createGainNode();l.volume4=c.createGainNode();l.masterVolume=c.createGainNode();h=c.createAnalyser();h.smoothingTimeConstant=.85;TRMixer.animateSpectrum();e.addEventListener("touchmove",function(e){if(e.target.type==="range")return;e.preventDefault()},!1)},loadSoundFile:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(n){console.log("Sound file loaded: ",e);TRMixer.initSound(this.response,t)};n.send()},initSound:function(e,t){c.decodeAudioData(e,function(e){switch(t){case 1:o=e;break;case 2:u=e;break;case 3:a=e;break;case 4:f=e}console.log("Audio file decoded: ",e);o&&u&&a&&f&&TRMixer.initMixer()},function(e){console.log("Error decoding file",e);document.getElementById("status").innerHTML="Status: Error loading sounds"})},initMixer:function(){var e=document,t=e.getElementById("channel1"),n=e.getElementById("channel2"),r=e.getElementById("channel3"),i=e.getElementById("channel4");e.getElementById("status").innerHTML="Status: Ready";e.getElementById("play").removeAttribute("disabled");e.getElementById("stop").removeAttribute("disabled");t.addEventListener("input",TRMixer.sliderChange,!1);n.addEventListener("input",TRMixer.sliderChange,!1);r.addEventListener("input",TRMixer.sliderChange,!1);i.addEventListener("input",TRMixer.sliderChange,!1);t.removeAttribute("disabled");n.removeAttribute("disabled");r.removeAttribute("disabled");i.removeAttribute("disabled")},routeSounds:function(){n=c.createBufferSource();n.buffer=o;n.loop=!0;r=c.createBufferSource();r.buffer=u;r.loop=!0;i=c.createBufferSource();i.buffer=a;i.loop=!0;s=c.createBufferSource();s.buffer=f;s.loop=!0;l.volume1.gain.value=.2;l.volume2.gain.value=.2;l.volume3.gain.value=.2;l.volume4.gain.value=.2;l.masterVolume.gain.value=1;n.connect(l.volume1);r.connect(l.volume2);i.connect(l.volume3);s.connect(l.volume4);l.volume1.connect(l.masterVolume);l.volume2.connect(l.masterVolume);l.volume3.connect(l.masterVolume);l.volume4.connect(l.masterVolume);l.masterVolume.connect(h);h.connect(c.destination)},playSounds:function(){c.activeSourceCount>0&&TRMixer.stopSounds();TRMixer.routeSounds();n.noteOn(0);r.noteOn(0);i.noteOn(0);s.noteOn(0)},stopSounds:function(){if(c.activeSourceCount>0){n.noteOff(0);r.noteOff(0);i.noteOff(0);s.noteOff(0)}},sliderChange:function(e){if(c.activeSourceCount>0)switch(e.target.id){case"channel1":l.volume1.gain.value=e.target.value;break;case"channel2":l.volume2.gain.value=e.target.value;break;case"channel3":l.volume3.gain.value=e.target.value;break;case"channel4":l.volume4.gain.value=e.target.value}},animateSpectrum:function(){p=requestAnimationFrame(TRMixer.animateSpectrum,document.querySelector("canvas"));TRMixer.drawSpectrum()},drawSpectrum:function(){var e=document.querySelector("canvas"),t=e.getContext("2d"),n=250,r=n,i=n,s=10,o=Math.round(r/s),u=new Uint8Array(h.frequencyBinCount),a,f;e.width=n-10;e.height=n-10;t.clearRect(0,0,r,i);t.fillStyle="#1d1c25";h.getByteFrequencyData(u);for(f=0;f<o;f+=1){a=u[f];t.fillRect(s*f,i,s-1,-a)}}}}();window.addEventListener("DOMContentLoaded",TRMixer.init,!0);
<!DOCTYPE html><html lang="en" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Fun with Web Audio and other modern API's – Alex Gibson</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="An article on building a synth effect unit using the Web Audio API and other new features available to web developers."><meta name="author" content="Alex Gibson"><meta name="generator" content="Jekyll"><link rel="canonical" href="https://alxgbsn.co.uk/2012/09/09/fun-with-web-audio-and-other-modern-apis/"><script type="module">try {
      const currentPref = sessionStorage.getItem('t-dark');
      const prefersDarkMode = currentPref === 'true' || (currentPref !== 'false' && window.matchMedia('(prefers-color-scheme: dark)').matches);

      if (prefersDarkMode) {
          document.documentElement.classList.add('js-t-dark');
      }

      // remove no-js class that supports dark theme with JS disabled.
      document.documentElement.classList.remove('no-js');
    } catch (e) {
      // do nothing.
    }</script><link rel="stylesheet" type="text/css" href="/assets/styles-5ea44c50f63519ccd193789a1a964cabf42ac3c2a2e13e10ef154f302e4c0769.css"><link rel="alternate" type="application/rss+xml" title="Alex Gibson" href="/feed/"><link rel="manifest" href="/manifest.json"><!--[if lt IE 9]>
    <script type="text/javascript" src="/assets/lib/html5shiv-6e9566e51098627c2824e546909ee18725d233fc9cdd81910819e7e108cf36c0.js"></script>
  <![endif]--><meta name="apple-mobile-web-app-title" content="Alex Gibson"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/avatar-180-b1f192dbbe4ceec9c13c327fb0908af5ddbf621002116885f0cc2e8d8b6787c8.jpg"><link rel="icon" type="image/png" sizes="196x196" href="/assets/avatar-196-a65772ff09fa529d865e4f60735ded2bfb50711bafb1bd79cb2111d7c4ec461c.jpg"><link href="/assets/favicon-28523dd6d2b5917829586fe5248f9a408486e09f98117add94210f56aa7ead33.ico" rel="shortcut icon"></head><body><main role="main"><div class="masthead"><nav role="navigation"><ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/contact/">Contact</a></li></ul></nav><div class="theme-selector hidden"><form class="theme-form" method="get"><input type="radio" id="t-light" name="theme" value="t-light" checked="checked"> <label for="t-light" title="Light theme">Light</label> <input type="radio" id="t-dark" name="theme" value="t-dark"> <label for="t-dark" title="Dark theme">Dark</label></form></div></div><article><header role="banner"><h1>Fun with Web Audio and other modern API's</h1></header><section class="post"><p class="meta"><time datetime="2012-09-09">September 09 2012</time> 5 min read.</p><p>Of all the new JavaScript API’s becoming available in web browsers today, the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">Web Audio API</a> has to be one of the most exciting recent additions for web app and HTML5 game developers. This API opens a whole range of new possibilities, and requires very little knowledge of DSP to achieve some pretty impressive results. In short, it offers the developer a lot more scope and control when compared to <del>using</del> abusing the poor old <a href="http://html5doctor.com/native-audio-in-the-browser/">HTML5 Audio element</a>.</p><h2 id="the-web-audio-api">The Web Audio API</h2><p>The Web Audio API works a bit like wiring together a modular, programmable synthesizer or audio processor. It is not only capable of playing back pre-recorded sounds with sample accuracy, but it can also create raw sound using <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#Oscillator">oscillators</a> and waveforms - the core elements of any audio synthesizer. It can route sounds, perform <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#RealtimeAnalyserNode">frequency analysis</a> and even apply native effects such as <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#ConvolverNode">convolution reverb</a>, <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#DelayNode">delay</a> and <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html#WaveShaperNode">distortion</a> effects.</p><p>The Web Audio API is currently supported in Chrome, Safari 6 and iOS6 Safari. I thought it was about time to start learning how to use the API and have some fun experimenting, so after a few hours I managed to throw together a relatively simple <a href="https://alexgibson.github.io/wavepad">synth effect unit</a>. It’s both mouse and touch friendly, and functions in a similar way to the <a href="http://www.korg.com/uk/products/dj/kaoss_pad_kp3_plus/">Korg Kaoss Pad</a>, albeit with a much simpler set of features.</p><p>The basic audio components for the demo are pretty simple. It consists of a single oscillator, a filter, a delay node, and two volume gain nodes (one for delay feedback, the other for master output). The demo also uses an audio frequency analyzer to create a visual representation of the audio output, which is drawn to the <a href="https://developer.mozilla.org/en-US/docs/HTML/Canvas">Canvas</a> for added real time, visual feedback.</p><p>Please note that the current WebKit implementation shown in the code examples below may differ from the final non-prefixed version, according to the official <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">W3C specification</a>.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myAudioContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webkitAudioContext</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">myAudioAnalyser</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createAnalyser</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createOscillator</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">nodes</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createBiquadFilter</span><span class="p">();</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createGainNode</span><span class="p">();</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createDelayNode</span><span class="p">();</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">feedbackGain</span> <span class="o">=</span> <span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">createGainNode</span><span class="p">();</span></code></pre></figure><p>The <code class="highlighter-rouge">source</code> is then routed through the processor <code class="highlighter-rouge">nodes</code> and connected to the audio context destination (i.e. the speakers).</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">source</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">filter</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">volume</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">delay</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">feedbackGain</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">feedbackGain</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">volume</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">feedbackGain</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">volume</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">myAudioAnalyser</span><span class="p">);</span>
<span class="nx">myAudioAnalyser</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">myAudioContext</span><span class="p">.</span><span class="nx">destination</span><span class="p">);</span></code></pre></figure><h2 id="responding-to-user-input">Responding to user input</h2><p>Touching the user interface surface manipulates the oscillator frequency along the <code class="highlighter-rouge">x</code> axis, and the filter cutoff value along the <code class="highlighter-rouge">y</code> axis. To start the sound, <code class="highlighter-rouge">source.noteOn(0)</code> is called.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">source</span><span class="p">.</span><span class="nx">frequency</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
<span class="nx">nodes</span><span class="p">.</span><span class="nx">filter</span><span class="p">.</span><span class="nx">frequency</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
<span class="nx">source</span><span class="p">.</span><span class="nx">noteOn</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></code></pre></figure><p>There are a range of different waveforms to use in the main oscillator, and multiple different filter types to experiment with. It’s more a musical toy than anything serious, but it can produce some interesting sci-fi effects and spaced-out synth sounds by using different delay times and feedback settings. If you haven’t already, have some fun and <a href="https://alexgibson.github.io/wavepad">try it out</a>.</p><p>Because this is a demo that currently runs in only the most modern browsers, I was also free to use some other useful new API’s and CSS effects.</p><h2 id="smoother-animations-using-requestanimationframe">Smoother animations using requestAnimationFrame</h2><p>Canvas animation frame rate is handled by the browser using <a href="http://paulirish.com/2011/requestanimationframe-for-smart-animating/">requestAnimationFrame</a>. This helps to achieve smoother animation and better browser performance. It is also better for your CPU (and battery), as <abbr title="requestAnimationFrame">rAF</abbr> will automatically pause animation when the browser tab is not visible.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">animateSpectrum</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mySpectrum</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">animateSpectrum</span><span class="p">);</span>
    <span class="nx">drawSpectrum</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure><h2 id="css-filter-effects">CSS Filter effects</h2><p>The red blur effect on the finger tracking element is achieved using <a href="http://www.html5rocks.com/en/tutorials/filters/understanding-css/">CSS filter effects</a>.</p><figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nc">.blurred</span> <span class="p">{</span>
    <span class="nl">-webkit-filter</span><span class="p">:</span> <span class="n">blur</span><span class="p">(</span><span class="m">5px</span><span class="p">);</span>
    <span class="nl">filter</span><span class="p">:</span> <span class="n">blur</span><span class="p">(</span><span class="m">5px</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure><h2 id="windowmatchmedia">window.matchMedia</h2><p>The adaptive user interface switches to a mobile optimized interface when the viewport is smaller than a set threshold. This is done using the <a href="https://developer.mozilla.org/en-US/docs/DOM/window.matchMedia">matchMedia</a> API to detect CSS Media Queries in JavaScript.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">breakPoint</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="s1">'(max-width: 512px)'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">isSmallViewport</span> <span class="o">=</span> <span class="nx">breakPoint</span><span class="p">.</span><span class="nx">matches</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">breakPoint</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">mql</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">isSmallViewport</span> <span class="o">=</span> <span class="nx">mql</span><span class="p">.</span><span class="nx">matches</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure><h2 id="classlist-api">classList API</h2><p>CSS active and pressed states are applied using the handy new <a href="https://developer.mozilla.org/en-US/docs/DOM/element.classList">classList API</a>. This makes adding and removing multiple class names in CSS much less of a chore.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">finger</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.finger'</span><span class="p">);</span>

<span class="nx">finger</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">'active'</span><span class="p">);</span>
<span class="nx">finger</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">'active'</span><span class="p">);</span></code></pre></figure><h2 id="page-visibility-api">Page Visibility API</h2><p>Audio is automatically muted when the browser tab is not active using the <a href="http://www.nczonline.net/blog/2011/08/09/introduction-to-the-page-visibility-api/">Page Visibility API</a>. This is currently supported in Chrome, but not yet in Safari 6.</p><h2 id="demo">Demo</h2><p>You can check out the <a href="https://alexgibson.github.io/wavepad">demo here</a>. Try it in Chrome, Safari 6 or iOS6. There are still a few glitches to iron out on iOS6, but feel free to <a href="https://github.com/alexgibson/wavepad/issues">open an issue</a> if you find a bug or have any new ideas for features.</p></section></article><footer role="contentinfo"><form role="search" class="search" action="https://duckduckgo.com/" method="get" title="Search this site"><label for="q">Search</label> <input type="hidden" name="sites" value="alxgbsn.co.uk"> <input class="search" type="search" name="q" id="q" placeholder="Search this site"> <button type="submit">Go</button></form><ul><li><a href="/feed/index.xml" title="RSS feed">Subscribe (RSS)</a></li></ul></footer></main><script type="module" src="/assets/theme-c123fb25e83dfa3f6932ea2db49aee4caa925d23bf05bed3593562542dd7fd66.js"></script><script type="module" src="/assets/main-e720254e216df6f38df9183d48fc5096b498cf7aa00bfdf57bf8aa71c31a7980.js"></script></body></html>